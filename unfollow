(async () => {
    function delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    function randomDelay(base = 1000, variance = 500) {
        return base + Math.floor(Math.random() * variance);
    }

    let stop = false;
    let unfollowedCount = 0;
    let batchCount = 0;
    const maxPerBatch = 10; // berhenti sementara setiap 10 unfollow
    const pauseDuration = 60 * 1000; // 1 menit

    console.log("üöÄ Mulai unfollow massal... Pastikan kamu ada di halaman 'following'.");

    while (!stop) {
        let buttons = [...document.querySelectorAll('button')]
            .filter(b => /Following|Diikuti/i.test(b.innerText.trim()));

        if (buttons.length === 0) {
            stop = true;
            console.log("‚úÖ Sudah selesai, tidak ada tombol lagi.");
            break;
        }

        for (let btn of buttons) {
            try {
                btn.scrollIntoView({ behavior: "smooth", block: "center" });
                await delay(randomDelay(800, 400));
                btn.click();
                await delay(randomDelay(800, 400));

                let confirmBtn = [...document.querySelectorAll('button')]
                    .find(b => /Unfollow|Berhenti mengikuti/i.test(b.innerText.trim()));
                
                if (confirmBtn) {
                    confirmBtn.click();
                    unfollowedCount++;
                    batchCount++;
                    console.log(`‚ùå Unfollow ke-${unfollowedCount}`);

                    // pause kalau sudah batch limit
                    if (batchCount >= maxPerBatch) {
                        console.log(`‚è∏ Istirahat ${pauseDuration / 1000} detik untuk menghindari limit...`);
                        batchCount = 0;
                        await delay(pauseDuration);
                    }
                    await delay(randomDelay(2000, 1000));
                }
            } catch (err) {
                console.warn("‚ö† Gagal unfollow:", err);
            }
        }

        window.scrollBy({
            top: 1000,
            behavior: "smooth"
        });
        await delay(randomDelay(2000, 1000));
    }

    console.log(`üéØ Total akun di-unfollow: ${unfollowedCount}`);
})();
